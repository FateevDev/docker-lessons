FROM node

# без этого все команды будут выполняться в корне
WORKDIR /app

# from local path (first dot) to working dir path (second dot)
# Если прежде мы указали WORKDIR, то здесь можно указывать относительный путь
#COPY . ./

# Нужно для того, чтобы каждый раз не запускать npm install
# Команда npm install будет срабатывать только при изменении файла package.json
COPY ./package.json /app
# Исполняется при создании образа, но не при запуске контейнера
RUN npm install

# или можно так, что более явно
COPY . /app

# Эта инструкция не открывает порт, это bestpractise по документированию докерфайла
# Добавлять ее необязятально
EXPOSE 80

# CMD - это обычно последняя инструкция в Dockerfile
# отличие от RUN в том, что CMD будет исполнятся только при запуске контейнера, а не при сборке образа
# это нужно, т.к. мы не хотим запускать сервер в образе, а только при старте контейнера
CMD ["node", "server.js"]
